name: Check pull request description checkbox
description: "Validate if a specific checkbox in a pull request description is checked or not."

branding:
  icon: "award"
  color: "green"

inputs:
  checkbox:
    description: "The name of the checkbox to verify"
    required: true
    default: "integration test (mandatory)"

runs:
  using: "composite"
  steps:
    - name: Check pull request description
      env:
        BODY: ${{ github.event.pull_request.body }}
        CHECKBOX: ${{ inputs.checkbox }}
      run: |
        set -x
        CHECKED="\[x\] $CHECKBOX"
        UNCHECKED="\[ \] $CHECKBOX"
        BODY_LOWER=$(echo "$BODY" | tr '[:upper:]' '[:lower:]')
        if [[ "$BODY_LOWER" =~ "$CHECKED" ]]; then
          echo "Checkbox is checked"
          exit 0
        elif [[ "$BODY_LOWER" =~ "$UNCHECKED" ]]; then
          echo "Checkbox is NOT checked"
          exit 1
        else
          echo "Checkbox not found in pull request description"
          exit 1
        fi
      shell: bash
